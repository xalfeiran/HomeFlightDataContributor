<!DOCTYPE html>
<html>
<head>
  <title>Home ADS-B Map</title>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    #map { height: 100vh; }
  </style>
</head>
<body>
<div id="map"></div>

<script>
const map = L.map('map').setView([0,0], 8);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

fetch('/api/home').then(r=>r.json()).then(h=>{
  map.setView([h.lat, h.lon], 8);
  L.circle([h.lat, h.lon], {radius: 1000}).addTo(map);
});

const icon = L.divIcon({html: '✈️', className:'', iconSize:[20,20]});

function refresh(){
  fetch('/api/aircraft').then(r=>r.json()).then(d=>{
    d.aircraft.forEach(a=>{
      if(!a.lat || !a.lon) return;

      const color = a.vert_rate > 0 ? 'green' :
                    a.vert_rate < 0 ? 'red' : 'gray';

      L.marker([a.lat, a.lon], {
        icon: L.divIcon({
          html: `<div style="color:${color};transform:rotate(${a.track||0}deg)">✈️</div>
                 <div>${a.flight||a.hex}</div>`
        })
      }).addTo(map);
    });
  });
}

setInterval(refresh, 2000);
</script>
</body>
</html>
